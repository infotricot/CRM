@model diplom_2.Models.Order

@{
   
    Layout = null;
}

<script type="text/javascript" src="~/ckeditor/ckeditor.js"></script>

<script src="~/js/jquery-1.11.1.min.js"></script>
<script src="~/js/select2.js"></script>
@*<div class="pageheader">
    <h2><i class="fa fa-dollar"></i> Заявка <span></span></h2>
    <div class="breadcrumb-wrapper">
        <span class="label">Вы тут:</span>
        <ol class="breadcrumb">
            <li><a href="index.html">Скобка</a></li>
            <li><a href="index.html">Страницы</a></li>
            <li class="active">Заявка</li>
        </ol>
    </div>
</div>*@

<div class="contentpanel">

    <div class="panel panel-default">
        <div class="panel-body">
            <div class="row">
                <div class="col-sm-6">

                    <h5 class="subtitle mb10">От</h5>
                    <img src="images/themeforest.png" class="img-responsive mb10" alt="" />
                    <address>
                        <strong>ThemeForest Web Services, Inc.</strong><br>
                        795 Folsom Ave, Suite 600<br>
                        San Francisco, CA 94107<br>
                        <abbr title="Phone">P:</abbr> (123) 456-7890
                    </address>

                </div><!-- col-sm-6 -->

                <div class="col-sm-6 text-right">                    
                    <h5 class="subtitle mb10">Кому</h5>
                    <address>
                        <strong>@ViewBag.Counterparty.Name</strong><br>
                       @ViewBag.Counterparty.Address    <br>
                       
                        @ViewBag.Counterparty.City<br>
                        @if (ViewBag.FirstContact != null)
                        {
                            <abbr title="Contacts"></abbr> @ViewBag.FirstContact.FIO
                        }
                    </address>

                    <p><strong>Дата создания заявки:</strong> @DateTime.Now.ToString("yyyy-MM-dd");</p>
                    @*<p><strong>Due Date:</strong> January 22, 2014</p>*@

                </div>
            </div><!-- row -->
            @using (Html.BeginForm(null, null, FormMethod.Post, new { id = "CreateOrderForm" }))
            {
                
        @Html.AntiForgeryToken()
                <input type="hidden" name="Counterparty_Id" id="Counterparty_Id" value="@ViewBag.CounterpartyId"/>
        <div class="form-horizontal">
          
            <hr />
            @Html.ValidationSummary(true, "", new { @class = "text-danger" })


            <div class="form-group">
                @Html.LabelFor(model => model.ReadyDate, htmlAttributes: new { @class = "control-label col-md-2" })
                <div class="col-md-10">

                    <div class="input-group">
                        <input type="text" class="form-control" id="datepicker" name="ReadyDate" value="@DateTime.Now.AddDays(14).ToShortDateString()">
                        <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                    </div>
                    @Html.ValidationMessageFor(model => model.ReadyDate, "", new { @class = "text-danger" })
                </div>
            </div>



            <div class="form-group">
                <label class="col-sm-2 control-label">Модель</label>
                <div class="col-sm-8">
                    <select id="selectList" class="select2" @*data-placeholder="Выберете или введите название модели"*@>
                        @*<option id="SelectedProduct" value=""></option>*@
                        @foreach (var product in diplom_2.Models.Product.GetProductFromSiteDb())
                {
                    <option model="@product.title" value="@product.nid">@product.title</option>
                        }
                    </select>
              
                </div>
                <div class="col-sm-2">
                    <input onclick="AddToOrder()" class="btn btn-primary mr5" type="button" value="Добавить в заявку" id="AddToOrderButton" />
                </div>
            </div>

            @*<div class="form-group">
                <div class="col-md-offset-2 col-md-10">
                   
                </div>
            </div>*@
        </div>

        <script>
            var CurrentRow = 0;
            function AddToOrder() {                
                var ProductName = $('#select2-selectList-container').attr('title');
                if (ProductName == undefined)
                    return;

                var ProductId = $('#selectList').find(":selected").val();
                //$('#selectList').val(null).trigger('change');               
                //$('#tbody').append('<tr><td><div class="text-primary"><strong>' + ProductName + '</strong></div></td ><td></td><td>$99.00</td><td>$99.00</td></tr >');
                $('#tbody').append('<tr class="row" id="Row_' + CurrentRow + '"><td class="col-md-5"><input name="ProductId" type="hidden" value="' + ProductId + '"><div class="text-primary"><input type="hidden" name="ProductName" value="' + ProductName + '"><strong>' + ProductName + '</strong></div></td ><td  class="col-md-3"><input style="width: 100%" type="text" name="MatColor"></td><td  class="col-md-2"><input style="width: 100%"  type="text" name="Size"></td><td  class="col-md-1"><input style="width: 100%"  type="text" name="amount"></td><td  class="col-md-1"><div style="cursor: pointer" onclick="RemoveRow(' + CurrentRow + ')">X</div></td></tr>');
                CurrentRow++;
            }

            function RemoveRow(V)
            {
                $("#Row_" + V).remove();
            }
        </script>
            <div class="table-responsive">
                <table class="table table-invoice">
                    <thead>
                        <tr class="row">
                            <th class="col-md-5">Модель</th>
                            <th class="col-md-3">Тип ткани, цвет</th>
                            <th class="col-md-2">Размер</th>
                            <th class="col-md-1">Количество</th>
                            <th class="col-md-1"></th>
                        </tr>
                    </thead>
                    <tbody  id="tbody">

                        @*<tr>
                            <td>
                                <div class="text-primary"><strong>Wordpress Template Customization</strong></div>
                                <small>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam</small>
                            </td>
                            <td>1</td>
                            <td>$99.00</td>
                            <td>$99.00</td>
                        </tr>*@                     
                    </tbody>
                </table>
                @Html.ValidationMessageFor(model => model.Products, "", new { @class = "text-danger" })
            </div><!-- table-responsive -->
       <hr />
        <div class="form-group">
            <div class="col-md-2">
                Примечание
            </div>
            <div class="col-md-10">
                <textarea name="Comments" id="Comments" style="width:100%"></textarea>
            </div>
        </div>

        <div id="ImageContainer">
            <div id="FormGroup1" class="form-group">
             
                <div class="control-label col-md-2">
                    <b>Выберете изображение</b>
                </div>
                <div class="col-md-5">
                    <input id="Image1Url" name="Image1Url" type="file" onchange="ImageChange(1)" style="float: left;" />
                </div>
                @*<div class="col-md-1">
                         Примечание
                    </div>
                    <div class="col-md-4">
                        <input name="notes" type="text" />
                    </div>*@
                <img id="Slide1" src="" width="200px" />
            </div>
        </div>
        <script>
            CKEDITOR.editorConfig = function (config) {
                // Define changes to default configuration here. For example:
                // config.language = 'fr';
                // config.uiColor = '#AADC6E';
                config.removeButtons = 'Image';

            };

            var editor = CKEDITOR.replace('Comments');

          

            function ImageChange(n) {
                var file = $('#Image1Url').get(0).files[0];
                var fileData = new FormData();
                fileData.append(file.name, file);
                    $.ajax({
                        url: '/Orders/UploadImage', //куда отправляем запрос (в какой actio-метод какого контроллера)
                        type: "POST", //типа
                        data: fileData, //форма с данными
                        //чтобы протокол HTTP не исказил передаваемый файл, отключаем все флаги преобразований
                        contentType: false, //тип данных не указан
                        processData: false, //данные не нужно обрабатывать
                        success: function (result) {
                            
                            var html = "<img src='../../OrdersImages/" + result + "'/>";

                           // editor.insertHtml(html);

                            var newElement = CKEDITOR.dom.element.createFromHtml(html, editor.document);
                            editor.insertElement(newElement);

                          

                            //alert(result);
                            //$('#Slide' + number).attr('src', '../../OrdersImages/' + result);
                            //$('#InputImage' + number + 'Url').val(result);
                        },
                        error: function (err) {
                            alert(err.statusText);
                        }
                    })

               
            }

        
        </script>

        <div class="text-right btn-invoice">

            <input class="btn btn-primary mr5" type="submit" value="Создать заявку" />
            @*<button <i class="fa fa-dollar mr5"></i> Make A Payment</button>*@
            <button class="btn btn-white"><i class="fa fa-print mr5"></i> Распечатать</button>
        </div>
        <div>
            <button id="CloseButton" type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
        </div>
        <div class="mb40"></div>



        }
    </div><!-- panel-body -->
    </div><!-- panel -->
            
</div>
<script>
    var frm = $('#CreateOrderForm');

    frm.submit(function (e) {

        e.preventDefault();
       
        $.ajax({
            type: frm.attr('method'),
            url: frm.attr('action'),
            data: frm.serialize(),// + "&ProcessTypeId="+ +"&CounterpatyId="+ ,
            success: function (data) {
  //              $('#CloseButton').trigger('click');
                    $.ajax({
                        type: "GET",
                        url: '/Processes/ShowProcesses/' + data,
                        cache: false,
                        success: function (response) {
                            if ($('#ProcesseList_' + data).length == 0)
                                $('#ProcesseList').html(response);
                            else
                                $('#ProcesseList_' + data).html(response);
                        },
                        error: function (response) {
                            alert("Error");     
                        }
                    })

            },
            error: function (data) {
                alert('An error occurred.');
                alert(data);
            },
        });
    });
</script>



@*<div>
    @Html.ActionLink("Back to List", "Index")
</div>*@
@*<script src="~/js/select2.min.js"></script>*@
<script src="~/js/jquery-ui-1.10.3.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />

<script>
    jQuery(document).ready(function () {
        $("#ui-datepicker-div").remove();
     
        jQuery('#datepicker').datepicker({ dateFormat: 'dd.mm.yy' });
     
        //$("#selectList").select2();

        
        $("#selectList").select2({
            //width: '100%'
            tags: true
        });

        //$(".select2").select2({

        //    maximumSelectionLength: 1
        //});
      
    })
</script>
<script src="~/js/jquery-ui-1.10.3.min.js"></script>